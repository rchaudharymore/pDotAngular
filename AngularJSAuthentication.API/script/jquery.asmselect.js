(function(a){a.fn.asmSelect=function(b){var c={listType:"ol",sortable:false,highlight:false,animate:false,addItemTarget:"bottom",hideWhenAdded:false,debugMode:false,countNotice:false,listTitle:false,autoComplete:false,removeLabel:"remove",highlightAddedLabel:"Added: ",highlightRemovedLabel:"Removed: ",countLabel:"* No items selected",countSuffix:"items selected",listTitleLabel:"List items",containerClass:"asmContainer",selectClass:"asmSelect",optionDisabledClass:"asmOptionDisabled",listClass:"asmList",listSortableClass:"asmListSortable",listItemClass:"asmListItem clearWrapper",listItemLabelClass:"asmListItemLabel",removeClass:"asmListItemRemove",highlightClass:"asmHighlight",countLabelClass:"asmCountList",listTitleLabelClass:"asmListTitle",disabledItemClass:"asmDisabled"};a.extend(c,b);return this.each(function(n){var H=a(this);var t=H.clone();var x;var C;var q;var o;var r=false;var e=false;var h=false;var j=0;function z(){while(a("#"+c.containerClass+n).size()>0){n++}C=a("<select></select>").addClass(c.selectClass).attr("name",c.selectClass+n).attr("id",c.selectClass+n);$selectRemoved=a("<select></select>");q=a("<"+c.listType+"></"+c.listType+">").addClass(c.listClass).attr("id",c.listClass+n);x=a("<div></div>").addClass(c.containerClass).attr("id",c.containerClass+n);a(document).on("click",".asmCancelButton",k);B();C.change(p).click(I);H.change(v).wrap(x).after(q).after(C);if(c.sortable){E()}if(a("html").is(".lt-ie8")){q.css("display","inline-block")}s();G();if(c.autoComplete){A()}}function k(){var K=a("option",t);var J=a("#"+this.getAttribute("rel")).parent().find("[name='list[]']").find("option");J.each(function(L){switch(K[L].selected){case true:if(!J[L].selected){w(J[L].id)}break;case false:if(J[L].selected){m(J[L].id)}break}});F(null,"Reset to your currently saved list");return false}function G(){if(!c.listTitle){return}var J=a("<div></div>").addClass(c.listTitleLabelClass).attr("id",c.listTitleLabelClass+n).html(c.listTitleLabel);C.after(J)}function E(){q.sortable({items:"li."+c.listItemClass,handle:"."+c.listItemLabelClass,axis:"y",update:function(L,K){var J;a(this).children("li").each(function(M){$option=a("#"+a(this).attr("rel"));if(a(this).is(".ui-sortable-helper")){J=$option.attr("id");return}H.append($option)});if(J){y(J,"sort")}}}).addClass(c.listSortableClass)}function p(J){if(a("html").is(".lt-ie7")&&!e){return}var K=a(this).find("option:selected").slice(0,1).attr("rel");w(K);e=false;y(K,"add")}function I(){e=true}function v(J){if(h){h=false;return}C.empty();q.empty();B()}function B(){r=true;C.prepend("<option value='select_label'>"+H.attr("title")+"</option>");D(H.children("option"),C);H.children("optgroup").each(function(K){var J=a('<optgroup label="'+a(this).attr("label")+'"/>');C.append(J);D(a(this).children("option"),J,K)});if(!c.debugMode){H.hide()}g();r=false}function D(J,K,L){J.each(function(N){if(!a(this).attr("id")){if(L!==undefined){a(this).attr("id","asm"+n+"group"+L+"option"+N)}else{a(this).attr("id","asm"+n+"option"+N)}}var M=a(this).attr("id");if(a(this).is(":selected")){w(M);i(K,M,true)}else{i(K,M)}})}function i(L,M,K){if(K==undefined){var K=false}var J=a("#"+M);var N=a("<option>"+J.html()+"</option>").val(J.val()).attr("rel",M);if(K){u(N)}L.append(N)}function g(){C.children(":eq(0)").attr("selected",true)}function u(J){J.addClass(c.optionDisabledClass).attr("selected",false).attr("disabled",true);if(c.hideWhenAdded){J.hide()}if(!a("html").is(".ie")){C.hide().show()}}function f(J){J.removeClass(c.optionDisabledClass).attr("disabled",false);if(c.hideWhenAdded){J.show()}if(a("html").not(".ie")){C.hide().show()}}function w(M){var L=a("#"+M);if(!L){return}var N=a('<a><i class="icon-minus-sign"></i></a>').attr("href","#").attr("title","Remove").addClass(c.removeClass).addClass("text-error").click(function(){m(a(this).closest("li").attr("rel"));return false});var K=a("<span></span>").addClass(c.listItemLabelClass).html(L.html());var J=a("<li></li>").attr("rel",M).addClass(c.listItemClass).prepend(K).prepend(N).hide();if(!r){if(L.is(":selected")){return}L.attr("selected",true)}if(c.addItemTarget=="top"&&!r){q.prepend(J);if(c.sortable){H.prepend(L)}}else{q.append(J);if(c.sortable){H.append(L)}}d(J);u(a("[rel="+M+"]",C));if(!r){F(J,c.highlightAddedLabel);g();if(c.sortable){q.sortable("refresh")}}s()}function d(J){if(c.animate&&!r){J.slideDown()}else{J.show()}}function m(L,J){if(J==undefined){var J=true}var K=a("#"+L);K.attr("selected",false);$item=q.children("li[rel="+L+"]");l($item);f(a("[rel="+L+"]",c.removeWhenAdded?$selectRemoved:C));if(J){F($item,c.highlightRemovedLabel)}s();y(L,"drop");if(c.autoComplete==true){C.hide()}}function l(J){if(c.animate&&!r){$prevItem=J.prev("li");J.animate({opacity:"hide",height:"hide"},100,"linear",function(){$prevItem.animate({"margin-bottom":"+=2px"},50,"swing",function(){$prevItem.animate({"margin-bottom":"-=2px"},100,"swing")});J.remove()})}else{J.remove()}}function F(J,K){if(!c.highlight){return}C.next("#"+c.highlightClass+n).remove();var L=a("<span></span>").hide().addClass(c.highlightClass).attr("id",c.highlightClass+n);if(J){L.html(K+J.children("."+c.listItemLabelClass).slice(0,1).html())}else{L.html(K)}C.after(L);L.fadeIn("fast",function(){setTimeout(function(){L.fadeOut("slow")},2000)})}function s(){if(!c.countNotice){return}var J=a("#"+c.countLabelClass+n);if(J.length==0){J=a("<span></span>").addClass(c.countLabelClass).attr("id",c.countLabelClass+n).html(c.countLabel);C.before(J)}if(H.find(":selected").size()==0){J.html(c.countLabel)}else{J.html(H.find(":selected").size()+" "+c.countSuffix)}}function y(K,J){h=true;$option=a("#"+K);H.trigger("change",[{option:$option,value:$option.val(),id:K,item:q.children("[rel="+K+"]"),type:J}])}function A(){a.widget("ui.asmAuto",{_create:function(){var L=this,J=C.hide(),N=J.children(":selected"),O=N.val()?N.text():"";this.originalValue=N.text();var M=N.text();var K=this.input=a("<input>").insertBefore(J).val(O).addClass("asmSelect autocomplete").autocomplete({delay:0,minLength:0,source:function(Q,P){var R=new RegExp(a.ui.autocomplete.escapeRegex(Q.term),"i");P(J.children("option").map(function(){var S=a(this).text();if(this.value&&(!Q.term||R.test(S))){return{label:S.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+a.ui.autocomplete.escapeRegex(Q.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"),value:S,option:this}}}))},select:function(P,Q){Q.item.option.selected=true;L._trigger("selected",P,{item:Q.item.option});if(a.trim(Q.item.value).length>0){this.originalValue=Q.item.value}else{this.originalValue=""}},change:function(Q,R){if(!R.item){var S=new RegExp("^"+a.ui.autocomplete.escapeRegex(a(this).val())+"$","i"),P=false;J.children("option").each(function(){if(a(this).text().match(S)){this.selected=P=true;return false}});if(!P){a(this).val(this.originalValue);J.val(this.originalValue);K.data("autocomplete").term=this.originalValue;return false}}},close:function(P,Q){if(!Q.item&&P.originalEvent&&a(this).val()==""){a(this).val(this.originalValue);J.val(this.originalValue);K.data("autocomplete").term=this.originalValue}a("input.asmSelect").val(M)}}).addClass("ui-widget ui-widget-content ui-corner-left");K.data("autocomplete")._renderItem=function(P,Q){var R=H.val()||[];if(jQuery.inArray(Q.option.value,R)==-1){return a("<li></li>").data("item.autocomplete",Q).append("<a>"+Q.label+"</a>").appendTo(P)}};this.clickFn=function(){if(K.autocomplete("widget").is(":visible")){K.val(this.originalValue);K.autocomplete("close");return}this.originalValue=K.val();K.val("");K.autocomplete("search","");K.focus();return false};K.click(this.clickFn);K.keydown(function(P){if(P.which=="27"){K.val(this.originalValue);K.blur()}});if(K.is(":visible")){K.width(J.width())}else{K.width(j)}this.button=a("<button type='button'>&nbsp;</button>").attr("tabIndex",-1).attr("title","Show All Items").insertAfter(K).button({icons:{primary:"ui-icon-triangle-1-s"},text:false}).removeClass("ui-corner-all").addClass("ui-corner-right ui-button-icon asmSelect autocomplete").click(this.clickFn)},destroy:function(){this.input.remove();this.button.remove();this.element.show();a.Widget.prototype.destroy.call(this)}});C.asmAuto({selected:function(J,K){C.change();C.hide()}})}z()})}})(jQuery);